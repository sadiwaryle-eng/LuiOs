<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixel Dot Camera + Video Mobile</title>
<style>
body {
    background: #111;
    color: #eee;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 10px;
}
h1 { text-align:center; margin-bottom:10px; }
button { margin:5px; padding:8px 15px; background:#444; border:none; color:#eee; cursor:pointer; border-radius:5px; }
input { margin:5px; }
#pixelOutput { line-height:6px; font-size:6px; white-space: pre; margin-top:10px; }
</style>
</head>
<body>

<h1>Pixel Dot Mobile ðŸ¤¯</h1>

<div>
    <button onclick="startWebcam()">Webcam</button>
    <button onclick="stopWebcam()">Stop Webcam</button>
    <input type="file" id="videoFile" accept="video/*">
</div>

<label>Pixel Size: <input type="number" id="pixelSize" value="8" min="1" max="32"></label>

<video id="video" autoplay muted style="display:none;"></video>
<pre id="pixelOutput"></pre>

<script>
const video = document.getElementById('video');
const output = document.getElementById('pixelOutput');
const pixelInput = document.getElementById('pixelSize');

let stream = null;
let mode = null; // "webcam" or "video"

function startWebcam(){
    stopWebcam(); // stop any previous stream
    navigator.mediaDevices.getUserMedia({video:true}).then(s=>{
        stream=s;
        video.srcObject=stream;
        video.play();
        mode="webcam";
        drawLoop();
    }).catch(err=>alert("Camera access denied!"));
}

function stopWebcam(){
    if(stream){
        stream.getTracks().forEach(track=>track.stop());
        stream=null;
    }
    mode=null;
}

document.getElementById('videoFile').addEventListener('change', e=>{
    const file = e.target.files[0];
    if(!file) return;
    stopWebcam();
    mode="video";
    video.src = URL.createObjectURL(file);
    video.play();
    drawLoop();
});

function drawLoop(){
    if(!mode) return;
    if(video.readyState<2){ 
        requestAnimationFrame(drawLoop);
        return;
    }

    const pixelSize = parseInt(pixelInput.value);
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = Math.floor(video.videoWidth/pixelSize);
    canvas.height = Math.floor(video.videoHeight/pixelSize);
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;

    let outputText = '';
    for(let y=0; y<canvas.height; y++){
        for(let x=0; x<canvas.width; x++){
            const i = (y*canvas.width + x)*4;
            const r = data[i], g = data[i+1], b = data[i+2];
            const brightness = (r+g+b)/3;
            outputText += brightness>100 ? '.' : ' ';
        }
        outputText += '\n';
    }
    output.textContent = outputText;
    requestAnimationFrame(drawLoop);
}
</script>

</body>
</html>